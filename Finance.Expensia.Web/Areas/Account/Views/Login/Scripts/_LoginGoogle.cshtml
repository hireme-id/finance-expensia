@{
    var homePageUrl = Url.Action("Index", "Finance", new { area = "Core" });
    var getGoogleAuthUrl = Url.Action("GetGoogleAuthUrl", "Login");
    var loginUrl = Url.Action("Login", "Login");
    var refreshTokenUrl = Url.Action("RefreshToken", "Login");
}
<script type="text/javascript">
    const bodyElement = document.body;
    $(function () {
        LoginGoogle = new LoginGoogle();
        LoginGoogle.InitManagement();
    });

    function LoginGoogle() {
        return {
            InitManagement: function () {
                this.InitControls();
                this.InitHandlers();
                this.InitValidation();
                this.InitLoad();
            },
            InitControls: function () {
                
            },
            InitHandlers: function () {
                $('#btnlogingoogle').on('click', function () {
                    $.ajax({
                        type: 'POST',
                        url: '@getGoogleAuthUrl',
                        success: function (response) {
                            if (response.succeeded) {
                                window.location.href = response.obj;
                            }
                        },
                        error: function (xhr, status, error) {
                            console.error('Error:', error);
                        }
                    })
                });
            },
            InitValidation: function () {
            },
            InitLoad: function () {
                const urlParams = new URLSearchParams(window.location.search);
                const authCode = urlParams.get('code');

                if (UserSessionAvailable())
                    window.location.href = "@homePageUrl";
                
                if (authCode) {
                    $.ajax({
                        type: 'POST',
                        url: "@loginUrl?authCode=" + authCode,
                        success: function (response) {
                            if (response.succeeded) {
                                localStorage.setItem("accessToken", response.obj.accessToken);
                                localStorage.setItem("expiredAt", response.obj.expiredAt);
                                localStorage.setItem("refreshToken", response.obj.refreshToken);
                                localStorage.setItem("sessionExpiredAt", response.obj.sessionExpiredAt);

                                window.location.href = "@homePageUrl";
                            }
                            else {
                                alert(response.message);
                            }
                        },
                        error: function (xhr, status, error) {
                            console.error('Error:', error);
                        }
                    });
                }
                else {
                    bodyElement.classList.add('loaded');
                }
            }
        }
    };

    function UserSessionAvailable() {
        if (localStorage.getItem("accessToken") == null ||
            localStorage.getItem("expiredAt") == null ||
            localStorage.getItem("refreshToken") == null ||
            localStorage.getItem("sessionExpiredAt") == null) {
            return false;
        }
        
        const expiredAt = new Date(localStorage.getItem("expiredAt"));
        const sessionExpiredAt = new Date(localStorage.getItem("sessionExpiredAt"));

        if (new Date() >= sessionExpiredAt) {
            return false;
        }

        if (new Date() < expiredAt) {
            return true;
        }
        
        var refreshToken = {
            "url": "@refreshTokenUrl",
            "method": "POST",
            "timeout": 0,
            "headers": {
                "Authorization": "Bearer " + localStorage.getItem("refreshToken"),
                "Content-Type": "application/json"
            },
        };
        $.ajax(refreshToken).done(function (response) {
            if (response.succeeded) {
                localStorage.setItem("accessToken", response.obj.accessToken);
                localStorage.setItem("expiredAt", response.obj.expiredAt);
                localStorage.setItem("refreshToken", response.obj.refreshToken);
                localStorage.setItem("sessionExpiredAt", response.obj.sessionExpiredAt);

                window.location.reload();
            }
            else {
                return false;
            }
        });
    }
</script>