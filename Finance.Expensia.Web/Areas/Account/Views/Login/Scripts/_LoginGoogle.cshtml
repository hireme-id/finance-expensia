@inject IConfiguration Configuration
@{
    var apiUrl = Configuration["APIUrl"];
}
<script type="text/javascript">
    const bodyElement = document.body;
    $(function () {
        LoginGoogle = new LoginGoogle();
        LoginGoogle.InitManagement();
    });

    function LoginGoogle() {
        return {
            InitManagement: function () {
                this.InitControls();
                this.InitHandlers();
                this.InitValidation();
                this.InitLoad();
            },
            InitControls: function () {
                
            },
            InitHandlers: function () {
                $('#btnlogingoogle').on('click', function () {
                    $.ajax({
                        type: 'POST',
                        url: '@apiUrl/login/getauthurl',
                        success: function (response) {
                            if (response.obj) {
                                window.location.href = response.obj;
                            }
                        },
                        error: function (xhr, status, error) {
                            console.error('Error:', error);
                        }
                    })
                });
            },
            InitValidation: function () {
            },
            InitLoad: function () {
                const urlParams = new URLSearchParams(window.location.search);
                const authCode = urlParams.get('code');
                console.log('authcode ' + authCode);
                if (authCode) {
                    var url = '@Url.Action("Create", "Finance", new { area = "Core"})';

                    $.ajax({
                        type: 'POST',
                        url: '@apiUrl/user/login?authCode=' + authCode,
                        success: function (response) {
                            window.location.href = url;
                        },
                        error: function (xhr, status, error) {
                            console.error('Error:', error);
                        }
                    });
                }
                else {
                    bodyElement.classList.add('loaded');
                }
            }
        }
    };
</script>